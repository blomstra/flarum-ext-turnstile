(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const o=flarum.core.compat["forum/app"];var r=t.n(o);const n=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/components/ForgotPasswordModal"];var s=t.n(i);function a(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}const l=flarum.core.compat["common/Component"];var c=function(t){var e,o;function n(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).widgetId=void 0,e.turnstileLoaded=void 0,e}o=t,(e=n).prototype=Object.create(o.prototype),e.prototype.constructor=e,u(e,o);var i,s,l=n.prototype;return l.oninit=function(e){t.prototype.oninit.call(this,e),this.turnstileLoaded=!!window.turnstile},l.getCurrentTheme=function(){var t,e,o=null==(t=flarum.extensions["fof-nightmode"])?void 0:t.getTheme,n=null==(e=flarum.extensions["fof-nightmode"])?void 0:e.Themes;if(o&&n){var i=o();if(i===n.AUTO&&(i=window.matchMedia("(prefers-color-scheme:dark)").matches?n.DARK:n.LIGHT),i===n.DARK)return"dark";if(i===n.LIGHT)return"light"}return r().forum.attribute("turnstile_dark_mode")?"dark":"light"},l.onTurnstileComplete=function(t){var e,o;null==(e=(o=this.attrs).onTurnstileStateChange)||e.call(o,t)},l.onTurnstileExpire=function(){var t,e;this.widgetId&&window.turnstile.reset(this.widgetId),null==(t=(e=this.attrs).onTurnstileStateChange)||t.call(e,null)},l.onTurnstileError=function(){var t,e;null==(t=(e=this.attrs).onTurnstileStateChange)||t.call(e,null)},l.createTurnstile=function(){this.turnstileLoaded&&window.turnstile.render(this.element,this.config)},l.removeTurnstile=function(){this.turnstileLoaded&&this.widgetId&&window.turnstile.remove(this.widgetId)},l.oncreate=function(e){t.prototype.oncreate.call(this,e),this.createTurnstile()},l.onbeforeremove=function(e){t.prototype.onbeforeremove.call(this,e),this.removeTurnstile()},l.view=function(t){return this.turnstileLoaded?m("div",{class:"Blomstra-Turnstile"}):m("p",{class:"BlomstraTurnstile-notLoaded"},r().translator.trans("blomstra-turnstile.forum.not_loaded_error"))},i=n,(s=[{key:"config",get:function(){return{action:this.attrs.action,theme:this.getCurrentTheme(),sitekey:r().forum.attribute("blomstra-turnstile.site_key"),callback:this.onTurnstileComplete.bind(this),"expired-callback":this.onTurnstileExpire.bind(this),"error-callback":this.onTurnstileError.bind(this)}}}])&&a(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),n}(t.n(l)());const d=flarum.core.compat["common/components/Button"];var f=t.n(d);const p=flarum.core.compat["forum/components/ChangePasswordModal"];var h=t.n(p);const b=flarum.core.compat["forum/components/LogInModal"];var g=t.n(b);const v=flarum.core.compat["forum/components/SignUpModal"];var T=t.n(v);r().initializers.add("blomstra/turnstile",(function(){(0,n.extend)(T().prototype,"submitData",(function(t){r().forum.attribute("blomstra-turnstile.signup")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(T().prototype,"fields",(function(t){var e=this;r().forum.attribute("blomstra-turnstile.signup")&&t.add("turnstile",m(c,{action:"sign_up",onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5)})),(0,n.extend)(g().prototype,"loginParams",(function(t){r().forum.attribute("blomstra-turnstile.signin")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(g().prototype,"fields",(function(t){var e=this;r().forum.attribute("blomstra-turnstile.signin")&&t.add("turnstile",m(c,{action:"log_in",onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5)})),(0,n.extend)(s().prototype,"requestParams",(function(t){r().forum.attribute("blomstra-turnstile.forgot")&&(t.turnstileToken=this.__turnstileToken)})),(0,n.extend)(s().prototype,"fields",(function(t){var e=this;r().forum.attribute("blomstra-turnstile.forgot")&&t.add("turnstile",m(c,{action:"forgot_pw",onTurnstileStateChange:function(t){e.__turnstileToken=t}}),-5)})),h().prototype.__turnstileToken=null,(0,n.override)(h().prototype,"content",(function(t){var e=this;if(r().forum.attribute("blomstra-turnstile.forgot"))return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",{className:"helpText"},r().translator.trans("core.forum.change_password.text")),m("div",{className:"Form-group"},f().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},r().translator.trans("core.forum.change_password.send_button"))),m(c,{action:"forgot_pw",onTurnstileStateChange:function(t){e.__turnstileToken=t}})))})),(0,n.override)(h().prototype,"onsubmit",(function(t,e){r().forum.attribute("blomstra-turnstile.forgot")&&(e.preventDefault(),this.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/forgot",body:{email:r().session.user.email(),turnstileToken:this.__turnstileToken}}).then(this.hide.bind(this),this.loaded.bind(this)))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map